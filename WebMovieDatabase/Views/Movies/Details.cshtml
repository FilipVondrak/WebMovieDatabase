@model Movie

@{
    double averageRating = 0;

    if (Model.Ratings != null && Model.Ratings.Any())
    {
        averageRating = Model.Ratings.Average(r => r.StarRating);
    }
    else averageRating = 0;
}

<div class="container mt-4">
    <div class="row">

        <!-- left column - image and actors -->
        <div class="col-md-4">
            <img src="@Model.ImageUrl" class="img-fluid rounded shadow-sm" alt="@Model.Title"/>

            <h5 class="mt-4">Actors</h5>
            <ul class="list-unstyled">
                @foreach (var actor in Model.Actors)
                {

                    <li>@actor.Name</li>
                }
            </ul>
        </div>

        <!-- right column - title, rating, description -->
        <div class="col-md-8">
            <h1>@Model.Title</h1>

            <!-- rating stars -->
            <div class="mb-3 fs-4 text-warning">
                @for(int j = 4; j >= 0; j--)
                {
                    if (averageRating >= 1)
                    {
                        <img src="~/images/star-full-yellow.png" class="img-fluid" width="32" height="32" alt="star-full"/>
                        averageRating--;
                    }
                    else if (averageRating <= 0)
                    {
                        <img src="~/images/star-empty-yellow.png" class="img-fluid" width="32" height="32" alt="star-full"/>
                        averageRating--;
                    }
                    else
                    {
                        <img src="~/images/star-half-yellow.png" class="img-fluid" width="32" height="32" alt="star-full"/>
                        averageRating--;
                    }
                }
            </div>

            <p class="lead">@Model.Description</p>

            <!-- action Buttons -->
            <div class="mt-4">
                <a asp-controller="Ratings" asp-action="AddRating" asp-route-id="@Model.Id" class="btn btn-primary">Rate this movie</a>
                <a asp-action="Index" class="btn btn-secondary">Back to List</a>
                <a asp-action="Edit" asp-route-id="@Model.Id" class="btn btn-secondary">Edit</a>
                <form asp-action="Delete" asp-route-id="@Model.Id" method="post" class="d-inline">
                    <button type="submit" class="btn btn-danger">Remove</button>
                </form>
            </div>
        </div>
    </div>

    <!-- reviews -->
    <hr class="my-4" />
    <div class="row">
        <div class="col-12">
            <h2>Reviews</h2>
            <div class="d-flex flex-column gap-1">
                @foreach (var rating in Model.Ratings)
                {
                    <div class="card mb-3 p-3 d-flex flex-row align-items-center">
                        <div class="col-auto">
                            <img src="~/images/account.png" class="rounded-circle" width="64" height="64" alt="user icon"/>
                        </div>

                        <div class="col ps-3">
                            <h6 class="fw-bold">@rating.User.UserName</h6>

                            <div class="d-flex flex-row mb-2">
                                @for (int i = 4; i >= 0; i--)
                                {
                                    // TODO: redo later
                                    if (rating.StarRating >= 1)
                                    {
                                        <img src="~/images/star-full.png" class="img-fluid" width="24" height="24" alt="star-full"/>
                                        rating.StarRating--;
                                    }
                                    else if (rating.StarRating > 0)
                                    {
                                        <img src="~/images/star-half.png" class="img-fluid" width="24" height="24" alt="star-full"/>
                                        rating.StarRating = 0;
                                    }
                                    else
                                    {
                                        <img src="~/images/star-empty.png" class="img-fluid" width="24" height="24" alt="star-empty"/>
                                    }
                                }
                            </div>

                            <p>@rating.Comment</p>
                        </div>
                    </div>
                }
            </div>
        </div>
    </div>
</div>